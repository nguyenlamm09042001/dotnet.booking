@model List<booking.Models.ServiceReview>

@{
    ViewData["Title"] = "Đánh giá khách hàng";
}

<div class="min-h-screen bg-white text-slate-900">
    <!-- Top bar -->
    <header class="sticky top-0 z-40 border-b border-slate-200 bg-white/80 backdrop-blur">
        <div class="mx-auto max-w-6xl px-6">
            <div class="flex h-16 items-center justify-between">
                <div class="leading-tight">
                    <div class="text-sm font-extrabold">Đánh giá khách hàng</div>
                    <div class="mt-1 text-xs text-slate-500">
                        Tất cả đánh giá cho các dịch vụ của doanh nghiệp
                    </div>
                </div>

                <a asp-controller="Business" asp-action="Index"
                   class="inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50">
                    ← Quay lại Dashboard
                </a>
            </div>
        </div>
    </header>

    <main class="mx-auto max-w-6xl px-6 py-6">
        @if (Model == null || !Model.Any())
        {
            <div class="rounded-2xl border border-dashed border-slate-300 bg-white p-8 text-center">
                <div class="text-sm font-semibold text-slate-700">Chưa có đánh giá nào</div>
                <div class="mt-1 text-sm text-slate-500">
                    Khi khách hoàn tất booking và để lại review, nó sẽ hiện ở đây.
                </div>
            </div>
        }
        else
        {
            <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
                @foreach (var r in Model)
                {
                 
                        // ===== dữ liệu hiển thị =====
                        var stars = (r.Rating > 0) ? r.Rating : r.Stars;

                        var serviceName = r.Service?.Name ?? "Dịch vụ";
                        var category = r.Service?.Category;
                        var location = r.Service?.Location;
                        var price = r.Service?.Price ?? 0;

                       var customer = (r.User != null && !string.IsNullOrWhiteSpace(r.User.FullName))
    ? r.User.FullName
    : "Khách hàng";


                        var phone = (r.BookingOrder != null && !string.IsNullOrWhiteSpace(r.BookingOrder.Phone))
                            ? r.BookingOrder.Phone
                            : "";
                   

                    <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
                        <!-- Header: dịch vụ + sao -->
                        <div class="flex items-start justify-between gap-3">
                            <div class="min-w-0">
                                <div class="text-xs font-semibold text-slate-500">
                                    Đánh giá cho dịch vụ
                                </div>

                                <div class="mt-1 truncate text-base font-extrabold text-slate-900">
                                    @serviceName
                                </div>

                                <div class="mt-1 text-xs text-slate-500">
                                    @if (!string.IsNullOrWhiteSpace(category))
                                    {
                                        <span class="font-medium text-slate-700">@category</span>
                                    }
                                    @if (!string.IsNullOrWhiteSpace(location))
                                    {
                                        <span> • @location</span>
                                    }
                                    @if (price > 0)
                                    {
                                        <span> • @price.ToString("N0")đ</span>
                                    }
                                </div>
                            </div>

                            <div class="shrink-0 text-right">
                                <div class="text-sm font-black text-amber-600">
                                    ⭐ @stars / 5
                                </div>
                                <div class="mt-1 text-xs text-slate-400">
                                    @r.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                                </div>
                            </div>
                        </div>

                        <!-- Khách -->
                        <div class="mt-3 text-xs text-slate-500">
                            <span class="font-semibold text-slate-700">@customer</span>
                            @if (!string.IsNullOrWhiteSpace(phone))
                            {
                                <span> • @phone</span>
                            }
                        </div>

                        <!-- Comment -->
                        @if (!string.IsNullOrWhiteSpace(r.Comment))
                        {
                            <div class="mt-3 text-sm text-slate-700">
                                “@r.Comment”
                            </div>
                        }

                        <!-- Footer -->
                        <div class="mt-4 flex items-center justify-between text-xs text-slate-500">
                            <div>
                                Mã review:
                                <span class="font-semibold text-slate-700">#@r.Id</span>
                            </div>
                            @if (r.Rating > 0)
                            {
                                <div>
                                    Rating:
                                    <span class="font-semibold text-slate-700">@r.Rating</span>
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>
        }

        <!-- Nút theo template -->
        <div class="mt-6">
            <a asp-controller="Business" asp-action="Index"
               class="inline-flex w-full items-center justify-center rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50">
                Về Dashboard →
            </a>
        </div>
    </main>
</div>
