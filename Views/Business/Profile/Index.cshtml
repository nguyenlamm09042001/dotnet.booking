@model booking.ViewModels.BusinessProfileVm

@{
    ViewData["Title"] = "Hồ sơ doanh nghiệp";
}

<div class="min-h-screen bg-gradient-to-b from-slate-50 to-white">
    <div class="mx-auto max-w-4xl px-4 py-10">

        <!-- Top header (business style) -->
        <div class="mb-6">
            <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
                <div>
                    <div class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-1 text-xs font-semibold text-slate-600 ring-1 ring-slate-200">
                        <span class="h-2 w-2 rounded-full bg-indigo-500"></span>
                        Business Profile
                    </div>

                    <h1 class="mt-3 text-2xl font-extrabold tracking-tight text-slate-900 sm:text-3xl">
                        Hồ sơ doanh nghiệp
                    </h1>
                    <p class="mt-1 text-sm text-slate-600">
                        Cập nhật thông tin hiển thị cho khách hàng.
                    </p>
                </div>

                <div class="flex items-center gap-2">
                    <a asp-controller="Business" asp-action="Index"
                       class="inline-flex items-center justify-center rounded-2xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50">
                        ← Về dashboard
                    </a>
                </div>
            </div>
        </div>

        <!-- Main grid -->
        <div class="grid grid-cols-1 gap-6 lg:grid-cols-12">

            <!-- Left: Profile card -->
            <form id="profileForm"
                  asp-controller="BusinessProfile"
                  asp-action="Index"
                  method="post"
                  enctype="multipart/form-data"
                  class="lg:col-span-8 rounded-3xl border border-slate-200 bg-white shadow-sm">

                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="Id" />

                <!-- Card header -->
                <div class="flex items-start justify-between gap-4 border-b border-slate-200 px-6 py-5">
                    <div>
                        <div class="text-lg font-extrabold text-slate-900">Thông tin hồ sơ</div>
                        <div class="mt-1 text-sm text-slate-600">Quản lý logo, tên hiển thị, email liên hệ.</div>
                    </div>

                    <div class="hidden sm:flex items-center gap-2">
                        <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-700 ring-1 ring-slate-200">
                            @Model.Role
                        </span>
                    </div>
                </div>

                <!-- Card body -->
                <div class="px-6 py-6 space-y-6">

                    <div class="text-xs text-rose-600">
                        @Html.ValidationSummary()
                    </div>

                    <!-- Avatar block -->
                    <div class="rounded-3xl border border-slate-200 bg-slate-50 p-5">
                        <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                            <div>
                                <div class="text-sm font-extrabold text-slate-900">Logo / Hình đại diện</div>
                                <div class="mt-1 text-xs text-slate-600">JPG/PNG/WEBP, tối đa 3MB.</div>
                            </div>

                            <div class="flex items-center gap-4">
                                <div class="relative">
                                    <img id="avatarPreview"
                                         src="@(string.IsNullOrEmpty(Model.Avatar) ? "/images/placeholder-business.png" : Model.Avatar)"
                                         class="h-20 w-20 rounded-2xl object-cover ring-4 ring-white shadow-sm border border-slate-200" />

                                    <div class="absolute -bottom-2 -right-2 rounded-full bg-white p-1 shadow ring-1 ring-slate-200">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-700" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M9 2a1 1 0 0 0-1 1v1H6.414a2 2 0 0 0-1.414.586L3.586 6A2 2 0 0 0 3 7.414V19a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3V7.414a2 2 0 0 0-.586-1.414L19 4.586A2 2 0 0 0 17.586 4H16V3a1 1 0 0 0-1-1H9zm7 4h1.586l1.414 1.414V9h-2.126a3.001 3.001 0 0 0-5.748 0H9.126a3.001 3.001 0 0 0-5.748 0H3V7.414L4.414 6H6v1a1 1 0 0 0 2 0V6h8v1a1 1 0 0 0 2 0V6zM12 11a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm-5 8a5 5 0 1 1 10 0H7z"/>
                                        </svg>
                                    </div>
                                </div>

                                <div class="flex flex-col gap-2">
                                    <label class="inline-flex cursor-pointer items-center justify-center rounded-2xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50">
                                        Chọn ảnh
                                        <input id="avatarFileInput"
                                               asp-for="AvatarFile"
                                               type="file"
                                               accept="image/*"
                                               class="hidden" />
                                    </label>

                                    <button type="button" id="btnClearAvatar"
                                            class="inline-flex items-center justify-center rounded-2xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-800">
                                        Xoá chọn
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fields grid -->
                    <div class="grid grid-cols-1 gap-5 sm:grid-cols-2">
                        <!-- FullName -->
                        <div class="sm:col-span-2">
                            <label class="text-sm font-semibold text-slate-700">Tên doanh nghiệp</label>
                            <div class="mt-2 relative">
                                <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm0 4a3 3 0 1 1-3 3 3 3 0 0 1 3-3Zm0 14a7.966 7.966 0 0 1-5.5-2.2 4.5 4.5 0 0 1 9 0A7.966 7.966 0 0 1 12 20Z"/>
                                    </svg>
                                </span>

                                <input asp-for="FullName"
                                       class="h-11 w-full rounded-2xl border border-slate-200 bg-white pl-10 pr-3 text-sm text-slate-900
                                              placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-300 focus:border-indigo-300" />
                            </div>
                            <span asp-validation-for="FullName" class="mt-1 block text-xs text-rose-600"></span>
                        </div>

                        <!-- Email -->
                        <div class="sm:col-span-2">
                            <label class="text-sm font-semibold text-slate-700">Email liên hệ</label>
                            <div class="mt-2 relative">
                                <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Zm0 4-8 5-8-5V6l8 5 8-5Z"/>
                                    </svg>
                                </span>

                                <input asp-for="Email"
                                       class="h-11 w-full rounded-2xl border border-slate-200 bg-white pl-10 pr-3 text-sm text-slate-900
                                              placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-300 focus:border-indigo-300" />
                            </div>
                            <span asp-validation-for="Email" class="mt-1 block text-xs text-rose-600"></span>
                        </div>

                        <!-- Role (mobile) -->
                        <div class="sm:hidden">
                            <label class="text-sm font-semibold text-slate-700">Loại tài khoản</label>
                            <input value="@Model.Role"
                                   disabled
                                   class="mt-2 h-11 w-full rounded-2xl border border-slate-200 bg-slate-100 px-3 text-sm text-slate-600" />
                        </div>
                    </div>
                </div>

                <!-- Card footer -->
                <div class="flex flex-col gap-3 border-t border-slate-200 px-6 py-5 sm:flex-row sm:items-center sm:justify-between">
                    <div class="text-xs text-slate-500">
                        * Nhấn “Lưu thay đổi” để cập nhật thông tin hiển thị.
                    </div>

                    <div class="flex items-center gap-2">
                        <button type="button" id="btnBack"
                                class="inline-flex items-center justify-center rounded-2xl border border-slate-200 bg-white px-5 py-3
                                       text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50">
                            Hủy
                        </button>

                        <button type="submit"
                                class="inline-flex items-center justify-center rounded-2xl bg-indigo-600 px-5 py-3
                                       text-sm font-semibold text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-300">
                            Lưu thay đổi
                        </button>
                    </div>
                </div>
            </form>

            <!-- Right: Tips / status card -->
            <div class="lg:col-span-4 space-y-6">
                <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
                    <div class="text-sm font-extrabold text-slate-900">Gợi ý hiển thị</div>
                    <div class="mt-2 space-y-2 text-sm text-slate-600">
                        <div class="flex gap-2">
                            <span class="mt-1 h-2 w-2 rounded-full bg-emerald-500"></span>
                            <div>Logo vuông (1:1) sẽ đẹp nhất trên thẻ dịch vụ.</div>
                        </div>
                        <div class="flex gap-2">
                            <span class="mt-1 h-2 w-2 rounded-full bg-indigo-500"></span>
                            <div>Email nên là email chăm sóc khách hàng để dễ liên hệ.</div>
                        </div>
                        <div class="flex gap-2">
                            <span class="mt-1 h-2 w-2 rounded-full bg-amber-500"></span>
                            <div>Đổi logo xong nhớ bấm “Lưu thay đổi”.</div>
                        </div>
                    </div>
                </div>

                <div class="rounded-3xl border border-slate-200 bg-gradient-to-br from-indigo-50 to-white p-6 shadow-sm">
                    <div class="text-sm font-extrabold text-slate-900">Trạng thái tài khoản</div>
                    <div class="mt-2 text-sm text-slate-600">
                        Loại tài khoản hiện tại:
                        <span class="font-semibold text-slate-900">@Model.Role</span>
                    </div>
                    <div class="mt-4 rounded-2xl bg-white p-4 ring-1 ring-slate-200">
                        <div class="text-xs font-semibold text-slate-500">Tip</div>
                        <div class="mt-1 text-sm text-slate-700">
                            Nếu đổi logo mà khách chưa thấy, thử hard refresh (Cmd+Shift+R) hoặc thêm cache-busting cho ảnh.
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

@section Scripts {
<script>
  // preview ảnh + clear
  const fileInput = document.getElementById('avatarFileInput');
  const previewImg = document.getElementById('avatarPreview');
  const btnClear = document.getElementById('btnClearAvatar');

  // lưu src gốc để clear quay về
  const originalSrc = previewImg ? previewImg.getAttribute('src') : null;

  if (fileInput && previewImg) {
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;

      // (optional) validate size 3MB
      const maxBytes = 3 * 1024 * 1024;
      if (file.size > maxBytes) {
        Swal.fire({
          icon: 'warning',
          title: 'File quá lớn',
          text: 'Vui lòng chọn ảnh tối đa 3MB.'
        });
        fileInput.value = '';
        if (originalSrc) previewImg.src = originalSrc;
        return;
      }

      previewImg.src = URL.createObjectURL(file);
    });
  }

  if (btnClear && fileInput && previewImg) {
    btnClear.addEventListener('click', () => {
      fileInput.value = '';
      if (originalSrc) previewImg.src = originalSrc;
    });
  }

  // back button
  const btnBack = document.getElementById('btnBack');
  if (btnBack) {
    btnBack.addEventListener('click', () => {
      window.location.href = '@Url.Action("Dashboard", "Business")';
    });
  }

  // swal confirm submit
  const form = document.getElementById('profileForm');
  if (form) {
    form.addEventListener('submit', function (ev) {
      ev.preventDefault();

      Swal.fire({
        icon: 'question',
        title: 'Xác nhận lưu?',
        text: 'Bạn có chắc muốn cập nhật hồ sơ doanh nghiệp không?',
        showCancelButton: true,
        confirmButtonText: 'Lưu',
        cancelButtonText: 'Hủy',
        reverseButtons: true,
        confirmButtonColor: '#4f46e5'
      }).then((result) => {
        if (result.isConfirmed) form.submit();
      });
    });
  }

  // swal success/error từ TempData (escape đơn giản)
  @if (TempData["SwalType"] != null)
  {
      <text>
      Swal.fire({
        icon: '@TempData["SwalType"]',
        title: '@TempData["SwalTitle"]',
        text: '@TempData["SwalMessage"]'
      });
      </text>
  }
</script>
}
