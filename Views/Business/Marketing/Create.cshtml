@model booking.ViewModels.MarketingCreateVm
@{
    ViewData["Title"] = "Quảng cáo ngay";
    string Vnd(decimal v) => string.Format(System.Globalization.CultureInfo.GetCultureInfo("vi-VN"), "{0:N0}đ", v);
}

<div class="min-h-screen bg-gradient-to-b from-slate-50 to-white">
  <div class="mx-auto max-w-4xl px-4 py-10">

    <!-- Header -->
    <div class="mb-6">
      <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
        <div>
          <div class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-1 text-xs font-semibold text-slate-600 ring-1 ring-slate-200">
            <span class="h-2 w-2 rounded-full bg-amber-500"></span>
            Sponsored Listing
          </div>

          <h1 class="mt-3 text-2xl font-extrabold tracking-tight text-slate-900 sm:text-3xl">
            Quảng cáo ngay
          </h1>
          <p class="mt-1 text-sm text-slate-600">
            Gói ưu tiên hiển thị <span class="font-semibold text-slate-900">15.000đ/ngày</span>.
            Admin duyệt là lên mục <span class="font-semibold text-slate-900">“Được tài trợ”</span>.
          </p>
        </div>

        <div class="flex items-center gap-2">
          <a asp-controller="BusinessMarketing" asp-action="Index"
             class="inline-flex items-center justify-center rounded-2xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50">
            ← Lịch sử Ads
          </a>
        </div>
      </div>
    </div>

    <!-- Main grid -->
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-12">

      <!-- Form card -->
      <div class="lg:col-span-8 rounded-3xl border border-slate-200 bg-white shadow-sm">
        <div class="border-b border-slate-200 px-6 py-5">
          <div class="text-lg font-extrabold text-slate-900">Thiết lập chiến dịch</div>
          <div class="mt-1 text-sm text-slate-600">Chọn ngày bắt đầu và số ngày muốn chạy.</div>
        </div>

        <form id="marketingCreateForm" asp-action="Create" method="post" class="px-6 py-6 space-y-6">
          @Html.AntiForgeryToken()

          <div class="grid grid-cols-1 gap-5 sm:grid-cols-2">
            <!-- StartAt -->
            <div>
              <label class="text-sm font-semibold text-slate-700">Ngày bắt đầu</label>
              <input asp-for="StartAt" type="date"
                     class="mt-2 h-11 w-full rounded-2xl border border-slate-200 bg-white px-3 text-sm text-slate-900
                            focus:outline-none focus:ring-2 focus:ring-indigo-300 focus:border-indigo-300" />
              <span class="mt-1 block text-xs text-rose-600">@Html.ValidationMessageFor(m => m.StartAt)</span>
            </div>

            <!-- Days -->
            <div>
              <label class="text-sm font-semibold text-slate-700">Số ngày chạy</label>
              <input asp-for="Days" id="daysInput" type="number" min="1" max="365"
                     class="mt-2 h-11 w-full rounded-2xl border border-slate-200 bg-white px-3 text-sm text-slate-900
                            focus:outline-none focus:ring-2 focus:ring-indigo-300 focus:border-indigo-300" />
              <span class="mt-1 block text-xs text-rose-600">@Html.ValidationMessageFor(m => m.Days)</span>
            </div>
          </div>

          <!-- Cost card -->
          <div class="rounded-3xl border border-amber-200 bg-amber-50/60 p-5">
            <div class="flex items-start justify-between gap-3">
              <div>
                <div class="text-sm font-extrabold text-slate-900">Chi phí ước tính</div>
                <div class="mt-1 text-xs text-slate-600">Đơn giá cố định 15.000đ/ngày</div>
              </div>

              <div class="inline-flex items-center rounded-full bg-white px-3 py-1 text-xs font-semibold text-amber-700 ring-1 ring-amber-200">
                15.000đ/ngày
              </div>
            </div>

            <div class="mt-3 text-3xl font-extrabold tracking-tight text-slate-900" id="amountText">
              @Vnd(Model.Amount)
            </div>

            <div class="mt-2 text-xs text-slate-600">
              Ví dụ: 2 ngày = <span class="font-semibold text-slate-900">30.000đ</span>
            </div>

            <div class="mt-4 rounded-2xl bg-white p-4 ring-1 ring-amber-200">
              <div class="text-xs font-semibold text-slate-500">Lưu ý</div>
              <div class="mt-1 text-sm text-slate-700">
                Yêu cầu sẽ ở trạng thái <span class="font-semibold">chờ duyệt</span>. Khi admin duyệt, quảng cáo sẽ hiển thị ở mục “Được tài trợ”.
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="flex flex-col gap-3 border-t border-slate-200 pt-5 sm:flex-row sm:items-center sm:justify-between">
            <div class="text-xs text-slate-500">
              * Bạn có thể xem trạng thái trong “Lịch sử Ads”.
            </div>

            <div class="flex items-center gap-2 justify-end">
              <a asp-controller="BusinessDashboard" asp-action="Index"
                 class="inline-flex h-12 items-center justify-center rounded-2xl border border-slate-200 bg-white px-5 text-sm font-semibold text-slate-800 shadow-sm hover:bg-slate-50">
                Quay lại Dashboard
              </a>

              <button type="submit"
                      class="inline-flex h-12 items-center justify-center rounded-2xl bg-slate-900 px-5 text-sm font-semibold text-white shadow-sm hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-slate-300">
                Gửi yêu cầu Ads
              </button>
            </div>
          </div>
        </form>
      </div>

      <!-- Side card -->
      <div class="lg:col-span-4 space-y-6">
        <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
          <div class="text-sm font-extrabold text-slate-900">Tại sao nên chạy Ads?</div>
          <div class="mt-2 space-y-2 text-sm text-slate-600">
            <div class="flex gap-2">
              <span class="mt-1 h-2 w-2 rounded-full bg-amber-500"></span>
              <div>Lên khu “Được tài trợ” để tăng lượt xem.</div>
            </div>
            <div class="flex gap-2">
              <span class="mt-1 h-2 w-2 rounded-full bg-indigo-500"></span>
              <div>Hỗ trợ dịch vụ mới nhanh có khách.</div>
            </div>
            <div class="flex gap-2">
              <span class="mt-1 h-2 w-2 rounded-full bg-emerald-500"></span>
              <div>Ngân sách rõ ràng theo số ngày.</div>
            </div>
          </div>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-gradient-to-br from-amber-50 to-white p-6 shadow-sm">
          <div class="text-sm font-extrabold text-slate-900">Tip</div>
          <div class="mt-2 text-sm text-slate-700">
            Nếu muốn “quảng cáo ngay”, mặc định ngày bắt đầu là hôm nay (nhưng vẫn cho đổi nếu cần).
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

@section Scripts{
<script>
  (function(){
    const unit = 15000;
    const days = document.getElementById('daysInput');
    const out = document.getElementById('amountText');
    const form = document.getElementById('marketingCreateForm');
    if(!days || !out) return;

    function fmt(v){
      return new Intl.NumberFormat('vi-VN').format(v) + 'đ';
    }
    function recalc(){
      const d = Math.max(1, parseInt(days.value || '1', 10));
      out.textContent = fmt(d * unit);
    }
    days.addEventListener('input', recalc);
    recalc();

    // confirm submit
    if (form) {
      form.addEventListener('submit', function (ev) {
        ev.preventDefault();

        Swal.fire({
          icon: 'question',
          title: 'Gửi yêu cầu Ads?',
          text: 'Bạn có chắc muốn gửi yêu cầu quảng cáo theo số ngày đã chọn không?',
          showCancelButton: true,
          confirmButtonText: 'Gửi',
          cancelButtonText: 'Hủy',
          reverseButtons: true,
          confirmButtonColor: '#0f172a'
        }).then((result) => {
          if (result.isConfirmed) form.submit();
        });
      });
    }

    // swal từ TempData (nếu controller có set)
    @if (TempData["SwalType"] != null)
    {
      <text>
      Swal.fire({
        icon: '@TempData["SwalType"]',
        title: '@TempData["SwalTitle"]',
        text: '@TempData["SwalMessage"]'
      });
      </text>
    }
  })();
</script>
}
