@model List<booking.Models.MarketingOrder>

@{
    ViewData["Title"] = "Lịch sử Ads";

    string Vnd(decimal v) =>
        string.Format(System.Globalization.CultureInfo.GetCultureInfo("vi-VN"), "{0:N0}đ", v);

    string St(string s) => (s ?? "").ToLower() switch
    {
        "draft"    => "Chưa thanh toán",
        "pending"  => "Chờ admin duyệt",
        "approved" => "Đã duyệt",
        "rejected" => "Từ chối",
        _ => s
    };

    string StatusPillClass(string s) => (s ?? "").ToLower() switch
    {
        "approved" => "bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200",
        "rejected" => "bg-rose-50 text-rose-700 ring-1 ring-rose-200",
        "draft"    => "bg-slate-50 text-slate-700 ring-1 ring-slate-200",
        _          => "bg-amber-50 text-amber-700 ring-1 ring-amber-200"
    };

    string StatusDotClass(string s) => (s ?? "").ToLower() switch
    {
        "approved" => "bg-emerald-500",
        "rejected" => "bg-rose-500",
        "draft"    => "bg-slate-500",
        _          => "bg-amber-500"
    };
}

<div class="min-h-screen bg-gradient-to-b from-slate-50 to-white">
    <div class="mx-auto max-w-5xl px-4 py-10">

        <!-- Header -->
        <div class="mb-6">
            <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
                <div>
                    <div class="inline-flex items-center gap-2 rounded-full bg-white px-3 py-1 text-xs font-semibold text-slate-600 ring-1 ring-slate-200">
                        <span class="h-2 w-2 rounded-full bg-amber-500"></span>
                        Sponsored Listing
                    </div>

                    <h1 class="mt-3 text-2xl font-extrabold tracking-tight text-slate-900 sm:text-3xl">
                        Lịch sử Ads
                    </h1>
                    <p class="mt-1 text-sm text-slate-600">
                        Các yêu cầu quảng cáo của doanh nghiệp.
                    </p>
                </div>

                      

              <div class="flex items-center gap-2">
    <a asp-controller="Business"
       asp-action="Index"
       class="inline-flex items-center justify-center rounded-2xl border border-slate-300 bg-white px-5 py-3 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-300">
        ← Về trang chủ
    </a>

    <a asp-action="Create"
       class="inline-flex items-center justify-center rounded-2xl bg-indigo-600 px-5 py-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-300">
        + Quảng cáo ngay
    </a>
</div>

            </div>
        </div>

        <!-- Content -->
        <div class="space-y-4">
            @if (Model == null || !Model.Any())
            {
                <div class="rounded-3xl border border-slate-200 bg-white p-8 text-center shadow-sm">
                    <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-2xl bg-slate-100 ring-1 ring-slate-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-700" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm1 5a1 1 0 0 0-2 0v5a1 1 0 0 0 .293.707l2 2a1 1 0 0 0 1.414-1.414L13 11.586Z"/>
                        </svg>
                    </div>
                    <div class="mt-4 text-base font-extrabold text-slate-900">Chưa có đơn Ads nào</div>
                    <div class="mt-1 text-sm text-slate-600">Tạo yêu cầu quảng cáo để lên mục “Được tài trợ”.</div>

                    <div class="mt-5">
                        <a asp-action="Create"
                           class="inline-flex items-center justify-center rounded-2xl bg-slate-900 px-5 py-3 text-sm font-semibold text-white shadow-sm hover:bg-slate-800">
                            + Quảng cáo ngay
                        </a>
                    </div>
                </div>
            }
            else
            {
                <div class="grid grid-cols-1 gap-4">
                    @foreach (var o in Model)
                    {
                        var st = (o.Status ?? "").ToLower();

                        <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">

                                <div class="min-w-0">
                                    <div class="flex flex-wrap items-center gap-2">
                                        <div class="text-sm font-extrabold text-slate-900">
                                            Mã đơn: <span class="font-black">@o.Code</span>
                                        </div>

                                        <span class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-bold @StatusPillClass(o.Status)">
                                            <span class="h-2 w-2 rounded-full @StatusDotClass(o.Status)"></span>
                                            @St(o.Status)
                                        </span>
                                    </div>

                                    <div class="mt-2 flex flex-wrap items-center gap-2 text-xs text-slate-600">
                                        <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-700 ring-1 ring-slate-200">
                                            @o.Days ngày
                                        </span>

                                        <span class="inline-flex items-center rounded-full bg-white px-3 py-1 font-semibold text-slate-700 ring-1 ring-slate-200">
                                            @Vnd(o.Amount)
                                        </span>

                                        <span class="inline-flex items-center rounded-full bg-white px-3 py-1 font-semibold text-slate-700 ring-1 ring-slate-200">
                                            Bắt đầu: @(o.StartAt?.ToString("dd/MM/yyyy") ?? "—")
                                        </span>
                                    </div>

                                    <!-- Note -->
                                    <div class="mt-3 rounded-2xl bg-slate-50 p-4 ring-1 ring-slate-200">
                                        <div class="text-xs font-semibold text-slate-500">Ghi chú</div>
                                        <div class="mt-1 text-sm text-slate-700">
                                            @if (st == "approved")
                                            {
                                                <text>Đơn đã được duyệt và đang/đã hiển thị ở mục “Được tài trợ”.</text>
                                            }
                                            else if (st == "rejected")
                                            {
                                                <text>Đơn bị từ chối. Bạn có thể tạo đơn mới và chọn ngày/số ngày khác.</text>
                                            }
                                            else if (st == "draft")
                                            {
                                                <text>Đơn đã tạo nhưng chưa xác nhận chuyển khoản. Bấm “Thanh toán / Xác nhận” để lấy mã CK và gửi admin duyệt.</text>
                                            }
                                            else
                                            {
                                                <text>Đơn đang chờ admin duyệt. Khi được duyệt sẽ tự động hiển thị.</text>
                                            }
                                        </div>
                                    </div>

                                    <!-- Actions -->
                                    <div class="mt-4 flex flex-wrap items-center gap-2">
                                        @if (st == "draft")
                                        {
                                            <a asp-controller="BusinessMarketing"
                                               asp-action="Pay"
                                               asp-route-id="@o.Id"
                                               class="inline-flex items-center justify-center rounded-2xl bg-indigo-600 px-4 py-2 text-xs font-extrabold text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-300">
                                                Thanh toán / Xác nhận
                                            </a>
                                        }

                                        @if (st == "rejected")
                                        {
                                            <a asp-action="Create"
                                               class="inline-flex items-center justify-center rounded-2xl border border-slate-200 bg-white px-4 py-2 text-xs font-extrabold text-slate-700 shadow-sm hover:bg-slate-50">
                                                Tạo đơn mới
                                            </a>
                                        }

                                        @if (st == "approved")
                                        {
                                            <span class="inline-flex items-center rounded-2xl bg-emerald-50 px-4 py-2 text-xs font-extrabold text-emerald-700 ring-1 ring-emerald-200">
                                                Đang hiển thị (Sponsored)
                                            </span>
                                        }

                                        @if (st == "pending")
                                        {
                                            <span class="inline-flex items-center rounded-2xl bg-amber-50 px-4 py-2 text-xs font-extrabold text-amber-700 ring-1 ring-amber-200">
                                                Đang chờ duyệt
                                            </span>
                                        }
                                    </div>
                                </div>

                                <!-- Right meta -->
                                <div class="shrink-0 sm:text-right">
                                    <div class="text-xs font-semibold text-slate-500">Tổng chi</div>
                                    <div class="mt-1 text-lg font-extrabold text-slate-900">@Vnd(o.Amount)</div>

                                    <div class="mt-3 text-xs text-slate-500">
                                        Đơn giá: <span class="font-semibold text-slate-700">15.000đ/ngày</span>
                                    </div>

                                    @* optional: show created time if available *@
                                    @* <div class="mt-2 text-xs text-slate-500">Tạo lúc: @o.CreatedAt.ToString("dd/MM/yyyy HH:mm")</div> *@
                                </div>

                            </div>
                        </div>
                    }
                </div>

                <!-- Footer tip -->
                <div class="rounded-3xl border border-slate-200 bg-gradient-to-br from-amber-50 to-white p-6 shadow-sm">
                    <div class="text-sm font-extrabold text-slate-900">Tip</div>
                    <div class="mt-2 text-sm text-slate-700">
                        Muốn lên nhanh hơn thì tạo Ads vào ngày có nhiều lượt đặt (cuối tuần) và chạy tối thiểu 3–5 ngày để đủ “độ phủ”.
                    </div>
                </div>
            }
        </div>

    </div>
</div>
